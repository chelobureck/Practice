<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="site-wrapper">
        <div class="card">
            <span class="bubble bubble1"></span>
            <span class="bubble bubble2"></span>
            <span class="bubble bubble3"></span>
            <h1 id="main-title">Welcome to the Home Page</h1>
            <div id="chat-window" class="chat-window"></div>
            <form id="chat-form" class="chat-form" autocomplete="off">
                <input type="text" id="promptInput" placeholder="Введите сообщение..." class="input-text" autocomplete="off" />
                <button type="submit" class="btn">Отправить</button>
            </form>
        </div>
    </div>
    <script>
        let chatHistory = [];
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const promptInput = document.getElementById('promptInput');

        function addMessage(role, text) {
            chatHistory.push({role, text});
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-message ' + (role === 'user' ? 'user' : 'assistant');
            msgDiv.textContent = text;
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const userText = promptInput.value.trim();
            if (userText) {
                addMessage('user', userText);
                promptInput.value = '';
                // Показать "..." пока ждём ответ
                addMessage('assistant', '...');
                const loadingMsg = chatWindow.lastChild;
                try {
                    const response = await fetch('/gpt', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({prompt: userText})
                    });
                    const data = await response.json();
                    loadingMsg.textContent = data.answer || "Ошибка получения ответа";
                } catch (err) {
                    loadingMsg.textContent = "Ошибка соединения с сервером 111";
                }
            }
        });
    </script>
</body>
</html>